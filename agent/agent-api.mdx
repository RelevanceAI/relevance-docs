---
title: 'Conversation with an Agent via and API call'
sidebarTitle: 'Conversation'
description: 'How to make an API call to have a conversation with an Agent'
---

This page explains all the required steps to successfully make an API call to your Agent.

## Relevance Keys

<Snippet file="relevance-keys.mdx" />

## Agent Id

<Snippet file="agent-id.mdx" />

## Studio Id and Job Id

<Snippet file="agent-studio-job-id.mdx" />

## Conversation with the Agent

To start a conversation with your Agent, provide the corresponding values for `Region` and `Authorization token` in the
code snippet below and that's all :)

    ```Python
    authorization_token = f"{project_id}:{api_key}"  # Or copy directly from the API Keys page
    region = Region                                  # Can be found in the API Keys page

    ```

<Tip>
**The endpoint to trigger a conversation with an agent**:

`https://api-{region}.stack.tryrelevance.com/latest/studios/{studio_id}/async_poll/{job_id}`

See above for instructions to access \<region\>, \<studio_id\> and \<job_id\>.

</Tip>

```Python
# Replace these with the actual values obtained from the previous response
studio_id = agent_details["job_info"]["studio_id"]
job_id = agent_details["job_info"]["job_id"]

done = False
message = None

while True:
  # Define the URL with placeholders for studio_id and job_id
  url = f"https://api-{region}.stack.tryrelevance.com/latest/studios/{studio_id}/async_poll/{job_id}"

  # Define the authorization header
  headers = {
      "Authorization": authorization_token
  }

  # Send the POST request
  response = requests.get(url, headers=headers)

  message = response.json()

  for update in message['updates']:
    if update['type'] == "chain-success":
      done = True

  if done == True:
    break

  time.sleep(1000)
```

## List messages in a conversation

To list all the messages in a conversation, you can use the following code snippet. The messages
will be reverse chronological order, i.e. the newest message will be the first in the list.

```py
# Define the authorization header
headers = {
  "Authorization": authorization_token
}

conversation_id = agent_details["conversation_id"]

# Define the URL with placeholders for studio_id and job_id
url = f"https://api-{region}.stack.tryrelevance.com/latest/knowledge/list"

payload = {
  "knowledge_set": conversation_id,
  "page_size": 20,
  "sort": [
    {
      "insert_date_": "desc"
    }
  ]
}

messages = requests.post(url, headers=headers, json=payload).json()['results']
```

The messages follow this general structure:

```json

{
  "data": {
    "message": {
      "role": "" // the type of message in the conversation history. e.g. "user", "agent", "action-request"
      // ...other details dependent on the "role" above
    }
  }
}

```


## Continue a conversation

To continue a conversation, you'll need the `conversation_id` returned when you triggered the agent,
e.g. `agent_details["conversation_id"]` in the [Conversation with the agent](#conversation-with-the-agent) section above.
Then, you can trigger the agent as before, but with the `conversation_id` provided in the payload.

```py
# ... previous code same as before

payload = {
  "message": {
    "role": "user",
    "content": "Hello"
  },
  "agent_id": agent_id
  "conversation_id": agent_details["conversation_id"]
}

# ... subsequent code same as before
```

You can then follow the 

# Confirm or reject a tool run

As above, you'll need the `conversation_id` returned when you triggered the agent.
You'll also need the `action_request_id` and `action` of the tool run that you want to confirm or reject.
You can find it using the api request [here](#list-messages-in-a-conversation) and it should
be the newest (first) message in your conversation.

```py

# ... previous code same as before

action_request_message = message[0]['data']['message']
action = action_request_message['action']
action_request_id = action_request_message['action_request_id']

payload = {
  "message": {
    "role": "action-confirm", # or "action-reject"!
    "action": action,
    "action_request_id": action_request_id
  },
  "agent_id": agent_id
  "conversation_id": agent_details["conversation_id"]
}

# ... previous code same as before

```